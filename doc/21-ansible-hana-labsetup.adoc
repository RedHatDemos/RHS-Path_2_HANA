
=== Your Lab Environment

In this lab you work in a pre-configured lab environment.
You will have access to the following hosts:

[cols="v,v,v,v"]
|===
|Role|Hostname Ext|Hostname Int|Internal IP

|Jump Host & Ansible Control Host|workstation-<GUID>.rhpds.opentlc.com|workstation.example.com |192.168.0.10
|Hana Server||hana1.example.com|192.168.0.100

|===

WARNING: You will be able to SSH into the control host, from here you can SSH into the other hosts and run the ansible playbooks.

### Register for download Hana Express

HANA Express is a reduced Version of SAP HANA and requires less resources than HANA Platform Edition. It lacks at least the following features:

- Smart Data Integration (SDI)
- Smart Data Streaming
- Sytem Replication (HSR)
- Dynamic tiering

For a full list see http://news.sap.com/germany/files/2017/01/SAP-HANA-Express-Edition-FAQ-extern.pdf[the HANA Express FAQ]

For this quickstart guide you need to download the Binary installer method as described in detail on this page: https://www.sap.com/developer/tutorials/hxe-ua-installing-binary.html

As the SAP tutorial only describes the graphical interface which is not feasible for the training server in the cloud, you need to do the following

* Register for Hana Express at https://www.sap.com/sap-hana-express

image::hana01.png[]

* Download the platform independant installer (HXEDownloadManager.jar)

image::hana02.png[]

* Copy the Installer to your workstation, e.g. from Linux or Mac:

   $ scp HXEDownloadManager.jar your-sso-login@workstaion-GUID.rhpds.opentlc.com:/tmp/HXEDownloadManager.jar

TIP: You need to make sure that either /tmp/HXEDownloadManager.jar  or /tmp/hxe.tgz exist before continue with this script

=== Install Ansible on the control node and prepare HANA installer

1. Connect to the control node (workstation):

   # ssh your-sso-login@workstation-GUID.rhpds.opentlc.com

2. Become the `root` user:

   # sudo -i

3.  Run a script that installs ansible from EPEL and downloads and unpacks HANA express on hana1.example.com (this takes 5 - 10 minutes)

    # curl https://people.redhat.com/mkoch/training/scripts/setup_ansible_hana_env.sh | bash

4. Check that Ansible is installed and usable:

  # ansible --version
  ansible 2.5.2
    config file = /etc/ansible/ansible.cfg
    configured module search path = [u'/root/.ansible/plugins/modules', u'/usr/share/ansible/plugins/modules']
    ansible python module location = /usr/lib/python2.7/site-packages/ansible
    executable location = /bin/ansible
    python version = 2.7.5 (default, Oct 11 2015, 17:47:16) [GCC 4.8.3 20140911 (Red Hat 4.8.3-9)]

WARNING: The command to download HANA is already executed in the script. The following is informational only!

NOTE: The script calls the installer with these paramters to download HANA express unattended:
q
```
[mkoch-redhat.com@workstation-17ca ~]$  java -jar HXEDownloadManager.jar -d . linuxx86_64 installer hxe.tgz
Connecting to download server...

SAP HANA, express edition version: 2.00.030.00.20180403.2

WARNING: The package(s) you chose to download require a minimum of 8 GB of memory to install.  You only have 1 GB on this system.
Downloading "Server only installer"...
hxe.tgz : 100%
Concatenate download files to ./hxe.tgz...
./hxe.tgz created.
Verify ./hxe.tgz file checksum...
./hxe.tgz file checksum is OK.
[mkoch-redhat.com@workstation-17ca ~]$
```

=== Check the Prerequisites

NOTE: Ansible is keeping configuration management simple. Ansible requires no database or running daemons and can run easily on a laptop. On the managed hosts it needs no running agent.

Verify that the managed hosts accept password-less connections with key authentication from the workstation-GUID node as user ansible, e.g.:
----
[root@workstation-GUID ~]# su - ansible
[ansible@workstation-GUID ~]$ ssh hana1.example.com
[ansible@hana1 ~]$ exit
----

To allow user ansible to execute commands on hana1.example.com as root `sudo` needs to be configured on the managed hosts.

Test that the configuration allows ansible to run commands using `sudo` on hana1.example.com without a password, e.g.:
----
[ansible@workstation-GUID ~]$ ssh hana1.example.com
[ansible@servera ~]$ sudo cat /etc/shadow
[ansible@servera ~]$ exit
----

NOTE: *In all subsequent exercises you should work as the ansible user on the control node if not explicitly told differently.*

=== Setup the ansible environment

In the previous training you have learned how to create basic playbooks, setup an inventory file and start.

Test your setup with an ad-hoc command

WARNING: *Solution below*

1. Create a subdirectory `ansible-files`

   $ mkdir ~/ansible-files

2. Create an inventory file with your hana host in this directory

   $ echo "hana1.example.com" > ~ansible/ansible-files/inventory

3. Make sure your inventory file is used by default when executing commands from the `~/ansible-files/` directory. On workstation-GUID as ansible create the file `~/ansible-files/ansible.cfg` with the following content:

    [defaults]
    inventory=/home/ansible/ansible-files/inventory

4. Create directories for host and group variables needed later

   $ cd ~/ansible-files/
   $ mkdir host_vars group_vars

5. Test with an ad-hoc command that the ansible connection is working:
----
[ansible@workstation-GUID ~]$ ansible -m ping hana1.example.com
hana1.example.com | SUCCESS => {
    "changed": false,
    "ping": "pong"
}
----
